rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // **REGLAS EDUCATIVAS PARA MYLIBRARY** 游닄
    
    // Regla 1: Usuarios solo pueden acceder a sus propios datos
    // Ejemplo did치ctico de seguridad b치sica
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regla 2: Librer칤as personales - Solo el propietario puede modificar
    // Demuestra autorizaci칩n basada en ownership
    match /libraries/{userId}/books/{bookId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regla 3: Rese침as - Lectura p칰blica, escritura solo del autor
    // Ejemplo de permisos mixtos: lectura p칰blica vs escritura privada
    match /reviews/{reviewId} {
      // Cualquier usuario autenticado puede leer rese침as
      allow read: if request.auth != null;
      
      // Solo el autor puede crear/modificar/eliminar su rese침a
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
      
      allow update, delete: if request.auth != null 
        && request.auth.uid == resource.data.userId;
    }
    
    // Regla 4: Metadatos del sistema (solo lectura para usuarios autenticados)
    // Demuestra datos globales de solo lectura
    match /system/{document} {
      allow read: if request.auth != null;
      allow write: if false; // Solo administradores pueden escribir (no implementado en este ejemplo)
    }
  }
}